# Coturn configuration for Hades Project
# This configuration is optimized for the hades.lt domain and P2P gaming

# Listening configuration
listening-port=3478
listening-ip=0.0.0.0
relay-ip=${EXTERNAL_IP:-auto}
relay-ip-privacy

# TLS configuration (disabled if certificates not available)
# To enable TLS, ensure certificates exist at the specified paths
tls-listening-port=5349
cert=/etc/letsencrypt/live/cdn.hades.lt/fullchain.pem
pkey=/etc/letsencrypt/live/cdn.hades.lt/privkey.pem
cipher-list=ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384

# If certificates are not available, coturn will automatically disable TLS
# and only provide STUN/TURN over UDP/TCP (non-encrypted)

# Authentication
lt-cred-mech
use-auth-secret
static-auth-secret=${TURN_SECRET:-test-secret-key}
realm=${TURN_REALM:-cdn.hades.lt}

# Relay configuration
min-port=${MIN_PORT:-49152}
max-port=${MAX_PORT:-49999}
# Allow up to 1000 concurrent allocations
max-allocate-lifetime=3600
# Reduce bandwidth usage for gaming
bandwidth-limit-per-peer-kbps=10000

# Logging
verbose
log-file=/var/log/coturn/coturn.log
# Log to stdout for Docker
syslog

# Security
no-cli
no-tlsv1
no-tlsv1_1
no-sslv2
no-sslv3
# Require authentication for all allocations
secure-stun

# Performance
total-quota=1000
stale-nonce=600
# Reduce CPU usage for gaming traffic
cpu-limit=50

# Prometheus metrics (optional)
prometheus
prometheus-port=9641

# Web admin interface (optional, disabled for security)
no-web-admin

# Database (optional, for user management)
# userdb=/etc/coturn/turndb

# Fingerprint for WebRTC compatibility
fingerprint

# Allow loopback for testing
allow-loopback-peers

# Deny certain problematic peers
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=100.64.0.0-100.127.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.0.2.0-192.0.2.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=240.0.0.0-240.255.255.255
denied-peer-ip=255.255.255.255-255.255.255.255
denied-peer-ip=::1
denied-peer-ip=::ffff:0:0-::ffff:255.255.255.255
